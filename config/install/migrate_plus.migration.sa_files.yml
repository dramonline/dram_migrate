# Migration metadata
id: sa_files
label: sa_files
description: Migration from CSV to managed files
migration_group: "csv"

source:
  track_changes: true
  plugin: csv
  path: "/app/web/sites/default/files/migrations/sa_migrate_files.csv"
  delimiter: ","
  enclosure: '"'
  ids: [fid]

  constants:
    SOURCE: "https://soundamerican.org"
    DESTINATION: "public://migration-temp"

# Process plugin
process:
  uid:
    plugin: default_value
    default_value: 2
  fid: fid
  filemime: mimetype

  pseudo_source_path:
    plugin: concat
    source:
      - constants/SOURCE
      - path

  pseudo_destination_path:
    plugin: concat
    source:
      - constants/DESTINATION
      - filename
    delimiter: /

  uri:
    plugin: file_copy
    source:
      - "@pseudo_source_path" # source
      - "@pseudo_destination_path" # destination

# Destination plugin
destination:
  plugin: entity:file
  move: false

migration_dependencies: {}
